(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[631],{38462:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;this.bufferTime=e,this.audioToText=t,this.voiceManager=i,this.wordThreshold=n,this.isListening=!1}startListening(){return new Promise(((e,t)=>{console.log("Starting listening session..."),this.isListening=!0,this.audioToText.startContinuousRecognition((t=>{this.isListening&&e(t)})),this.audioToText.onerror=e=>{console.error("Error during speech recognition:",e),t(e)}}))}stopListening(){console.log("Stopping listening..."),this.isListening=!1,this.audioToText.stopRecognition()}enqueueText(e){return new Promise(((t,i)=>{console.log("Speaking text:",e),this.stopListening(),this.voiceManager.enqueueText(e).then((()=>{console.log("Finished speaking"),t(),setTimeout((()=>{this.resumeListening()}),this.bufferTime)})).catch((e=>{console.error("Error during speech:",e),i(e)}))}))}resumeListening(){console.log("Resuming listening..."),this.isListening=!0,this.startListening().then((e=>{this.detectInterruption(e)&&this.handleInterruption(e)})).catch((e=>{console.error("Error during resuming listening:",e)}))}detectInterruption(e){return e.split(" ").length>=this.wordThreshold}handleInterruption(e){console.log("User interruption detected: ".concat(e)),this.voiceManager.stopSpeech(),this.resumeListening()}resumeListeningAfterResponse(e){return new Promise((t=>{setTimeout((()=>{e("listening"),this.startListening().then((e=>{t(e)}))}),this.bufferTime)}))}}},42026:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"webspeech";this.recognition=null,this.isRecognizing=!1,this.isManuallyStopped=!1,this.initRecognition(e)}initRecognition(e){"webspeech"===e?(this.recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition),this.recognition.interimResults=!1,this.recognition.continuous=!0,this.recognition.lang="en-US"):console.error("Unsupported recognition type")}startContinuousRecognition(e){this.isRecognizing?(this.recognition.onend=()=>{this.isRecognizing=!1,this.startRecognitionProcess(e)},this.stopRecognition()):(this.isManuallyStopped=!1,this.startRecognitionProcess(e))}startRecognitionProcess(e){if(this.isRecognizing)return void console.warn("Recognition is already running, skipping start.");this.isRecognizing=!0;const t=[];this.recognition.onresult=i=>{const n=i.results;for(let e=i.resultIndex;e<n.length;e++)n[e].isFinal&&t.push(n[e][0].transcript.trim());e(t.join(" "))},this.recognition.onerror=t=>{"not-allowed"===t.error?(console.error("Recognition error: Microphone access was not allowed."),alert("Please allow microphone access to use the speech recognition feature."),this.stopRecognition()):"no-speech"===t.error?(console.warn("Recognition error: No speech detected."),this.isManuallyStopped||setTimeout((()=>{console.log("Restarting speech recognition after no-speech error..."),this.startRecognitionProcess(e)}),1e3)):(console.error("Recognition error:",t.error),this.stopRecognition())},this.recognition.onend=()=>{console.log("Speech recognition ended."),this.isRecognizing=!1,this.isManuallyStopped||(console.log("Restarting speech recognition..."),this.startRecognitionProcess(e))},this.recognition.start(),console.log("Speech recognition started.")}stopRecognition(){this.isRecognizing&&(this.isManuallyStopped=!0,this.recognition.stop(),console.log("Speech recognition stopped manually."),this.isRecognizing=!1)}}},69108:(e,t,i)=>{"use strict";i.d(t,{A:()=>f});var n=i(65043),o=i(79336);class s{constructor(){this.videoElement=null,this.isProcessing=!1,this.intervalId=null}initVideo(e){this.videoElement=e}async loadModels(){const e="/EVA-libre/models";try{await o.B0.tinyFaceDetector.loadFromUri(e),await o.B0.faceLandmark68Net.loadFromUri(e),await o.B0.faceExpressionNet.loadFromUri(e),await o.B0.faceRecognitionNet.loadFromUri(e),console.log("Models loaded successfully")}catch(t){throw console.error("Error loading models:",t),new Error("Failed to load face-api models")}}async startVideoStream(){try{if(!this.videoElement)throw new Error("Video element not initialized.");await this.loadModels();const e=await navigator.mediaDevices.getUserMedia({video:!0});this.videoElement.srcObject=e}catch(e){console.error("Error accessing webcam:",e)}}startContinuousDetection(e){if(this.isProcessing)return void console.warn("Emotion detection is already running.");this.isProcessing=!0;this.intervalId=setInterval((async()=>{if(!this.videoElement)return;const t=await o.R(this.videoElement,new o.ex).withFaceLandmarks().withFaceExpressions();if(t.length>0){const i=t[0].expressions;e(i)}}),100)}stopDetection(){this.isProcessing&&(clearInterval(this.intervalId),this.isProcessing=!1)}stopVideoStream(){if(this.videoElement&&this.videoElement.srcObject){this.videoElement.srcObject.getTracks().forEach((e=>e.stop())),this.videoElement.srcObject=null}}}const r=()=>{const[e,t]=(0,n.useState)({detectedEmotion:null,emotionIntensities:{joy:0,anger:0,disgust:0,fear:0,sadness:0,surprise:0},status:"idle"}),i=(0,n.useRef)(new s).current,o=(0,n.useRef)(null);return{emotionState:e,startEmoDetection:(0,n.useCallback)((async()=>{if(o.current)try{i.initVideo(o.current),await i.startVideoStream(),t((e=>({...e,status:"detecting"}))),i.startContinuousDetection((e=>{const i={joy:e.happy||0,anger:e.angry||0,disgust:e.disgusted||0,fear:e.fearful||0,sadness:e.sad||0,surprise:e.surprised||0},n=Object.keys(i).reduce(((e,t)=>i[e]>i[t]?e:t));t({detectedEmotion:n,emotionIntensities:i,status:"detecting"})}))}catch(e){console.error("Error starting emotion detection:",e)}else console.error("Video element not provided.")}),[i]),stopEmoDetection:(0,n.useCallback)((()=>{i.stopDetection(),i.stopVideoStream(),t({detectedEmotion:null,status:"stopped",emotionIntensities:{}})}),[i]),videoElementRef:o}};var a=i(85522),c=i(39627),l=i(34693),d=i(4758),g=i(70579);const h=e=>{let{videoElementRef:t,emotionState:i}=e;const[o,s]=(0,n.useState)({x:0,y:0}),[r,h]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1);return(0,g.jsxs)(a.az,{position:"fixed",width:u?"100px":"300px",height:u?"50px":"200px",cursor:u?"default":"move",onMouseDown:u?null:e=>{h(!0)},onMouseMove:u?null:e=>{if(r){const t=e.clientX-e.target.offsetWidth/2,i=e.clientY-e.target.offsetHeight/2;s({x:t,y:i})}},onMouseUp:u?null:()=>{h(!1);const e=window.innerWidth,t=o.x<e/2?10:e-event.target.offsetWidth-10,i=window.innerHeight-event.target.offsetHeight-10;s({x:t,y:i})},style:{left:"".concat(o.x,"px"),top:"".concat(o.y,"px"),zIndex:1e3},border:"2px solid gray",borderRadius:"10px",overflow:"hidden",boxShadow:"lg",bg:"gray.900",children:[(0,g.jsx)(a.az,{position:"absolute",top:"0",right:"0",children:(0,g.jsx)(c.K,{icon:u?(0,g.jsx)(l.M,{}):(0,g.jsx)(d.D,{}),size:"sm",onClick:()=>{p(!u)},"aria-label":"Toggle collapse"})}),!u&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("video",{ref:t,autoPlay:!0,muted:!0,style:{width:"100%",height:"100%"}}),(0,g.jsx)(a.az,{position:"absolute",bottom:"0",left:"0",p:"2",color:"white",bg:"rgba(0, 0, 0, 0.5)",children:i.detectedEmotion&&(0,g.jsxs)("div",{children:["Detected Emotion: ",i.detectedEmotion]})})]})]})};var u=i(6058),p=i(461);p.t1.register(p.pr,p.FN,p.No,p.dN,p.m_,p.s$);const m=e=>{let{emotionIntensities:t}=e;const i={labels:["Joy","Anger","Disgust","Fear","Sadness","Surprise"],datasets:[{label:"Emotion Intensities",data:[t.joy,t.anger,t.disgust,t.fear,t.sadness,t.surprise],backgroundColor:"rgba(34, 202, 236, 0.2)",borderColor:"rgba(34, 202, 236, 1)",borderWidth:2}]};return(0,g.jsx)(a.az,{width:"400px",height:"400px",p:4,children:(0,g.jsx)(u.Vd,{data:i,options:{scale:{ticks:{beginAtZero:!0,max:1},angleLines:{display:!0}}}})})};var x=i(11806);const f=e=>{let{onEmotionStateChange:t}=e;const{emotionState:i,startEmoDetection:o,stopEmoDetection:s,videoElementRef:a}=r();return(0,n.useEffect)((()=>(o(),()=>{s()})),[o,s]),(0,n.useEffect)((()=>{t&&t(i)}),[i,t]),(0,g.jsxs)("div",{children:[(0,g.jsx)(h,{videoElementRef:a,emotionState:i}),(0,g.jsx)(m,{emotionIntensities:i.emotionIntensities}),(0,g.jsx)(x.A,{text:i.detectedEmotion||""})]})}},34003:(e,t,i)=>{"use strict";i.d(t,{A:()=>c});var n=i(85522),o=i(53768),s=i(10157),r=i(13204),a=i(70579);const c=e=>{let{status:t}=e;return(0,a.jsx)(n.az,{position:"fixed",zIndex:"1000",bottom:"20px",left:"20px",bg:"gray.700",borderRadius:"md",p:4,boxShadow:"xl",userSelect:"none",children:(0,a.jsxs)(n.az,{display:"flex",flexDirection:"column",alignItems:"center",children:[(0,a.jsx)(o.I,{as:r.Qp1,color:{talking:"red.500",listening:"green.500",idle:"yellow.500"}[t],boxSize:6,mb:2}),(0,a.jsxs)(s.E,{color:"white",fontWeight:"bold",children:["talking"===t&&"Talking","listening"===t&&"Listening","idle"===t&&"Idle"]})]})})}},53409:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var n=i(65043);const o=(e,t,i,o,s)=>{const[r,a]=(0,n.useState)({status:"idle",transcribedText:null,speakingText:null}),c=(0,n.useRef)(s()).current,l=(0,n.useRef)(o()).current,d=(0,n.useCallback)((async e=>{e&&""!==e.trim()?(a((t=>({...t,status:"talking",speakingText:e}))),await t.enqueueText(e),a((e=>({...e,status:"listening",speakingText:null}))),h()):a((e=>({...e,status:"listening",speakingText:null})))}),[t]),g=(0,n.useCallback)((e=>{a((t=>({...t,status:"thinking",transcribedText:e})));const{value:t}=c.next(e);t&&d(t).then((()=>{const{value:e}=l.next();e?d(e):a((e=>({...e,status:"idle",speakingText:null})))}))}),[d,c,l]),h=(0,n.useCallback)((()=>{a((e=>({...e,status:"listening"}))),e.startContinuousRecognition((e=>{g(e)}))}),[e,g]);return{conversationState:r,startConversation:(0,n.useCallback)((async()=>{const{value:e}=l.next();a((t=>({...t,status:"talking",speakingText:e}))),await t.enqueueText(e),a((e=>({...e,status:"listening",speakingText:null}))),h()}),[t,h,l]),stopConversation:(0,n.useCallback)((()=>{e.stopRecognition(),t.stopSpeech(),a({status:"idle",transcribedText:null,speakingText:null})}),[e,t])}}},62872:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var n=i(65043);const o=(e,t)=>{(0,n.useEffect)((()=>{if(t&&t.detectedEmotion){const{detectedEmotion:n,emotionIntensities:o}=t;console.log("Detected Emotion:",n),console.log("Emotion Intensity:",o[n]),i(n,o[n],e)}}),[t,e]);const i=(e,t,i)=>{console.log("Mirroring ".concat(e," with intensity: ").concat(t));let n="joy"===e||"surprise"===e?0:2e3;switch(e){case"joy":!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;e.scheduleChange("12",t,i,0),e.scheduleChange("6",.6*t,i,0)}(i,100*t,500);break;case"sadness":setTimeout((()=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;e.scheduleChange("1",t,i,0),e.scheduleChange("15",.6*t,i,0)}(i,100*t,500)}),n);break;case"anger":setTimeout((()=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;e.scheduleChange("4",t,i,0),e.scheduleChange("7",t,i,0)}(i,100*t,700)}),n);break;case"surprise":!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;e.scheduleChange("5",t,i,0),e.scheduleChange("2",.8*t,i,0)}(i,100*t,300);break;case"fear":setTimeout((()=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;e.scheduleChange("5",t,i,0),e.scheduleChange("20",.8*t,i,0)}(i,100*t,700)}),n);break;case"disgust":setTimeout((()=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;e.scheduleChange("9",t,i,0),e.scheduleChange("10",.8*t,i,0)}(i,100*t,700)}),n);break;default:console.log("No valid emotion detected")}};return null}},18082:()=>{},97318:()=>{},40745:()=>{},41591:()=>{}}]);
//# sourceMappingURL=631.596b52f7.chunk.js.map