"use strict";(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[814],{38462:(e,t,n)=>{n.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;this.bufferTime=e,this.audioToText=t,this.voiceManager=n,this.wordThreshold=i,this.isListening=!1}startListening(){return new Promise(((e,t)=>{console.log("Starting listening session..."),this.isListening=!0,this.audioToText.startContinuousRecognition((t=>{this.isListening&&e(t)})),this.audioToText.onerror=e=>{console.error("Error during speech recognition:",e),t(e)}}))}stopListening(){console.log("Stopping listening..."),this.isListening=!1,this.audioToText.stopRecognition()}enqueueText(e){return new Promise(((t,n)=>{console.log("Speaking text:",e),this.stopListening(),this.voiceManager.enqueueText(e).then((()=>{console.log("Finished speaking"),t(),setTimeout((()=>{this.resumeListening()}),this.bufferTime)})).catch((e=>{console.error("Error during speech:",e),n(e)}))}))}resumeListening(){console.log("Resuming listening..."),this.isListening=!0,this.startListening().then((e=>{this.detectInterruption(e)&&this.handleInterruption(e)})).catch((e=>{console.error("Error during resuming listening:",e)}))}detectInterruption(e){return e.split(" ").length>=this.wordThreshold}handleInterruption(e){console.log("User interruption detected: ".concat(e)),this.voiceManager.stopSpeech(),this.resumeListening()}resumeListeningAfterResponse(e){return new Promise((t=>{setTimeout((()=>{e("listening"),this.startListening().then((e=>{t(e)}))}),this.bufferTime)}))}}},42026:(e,t,n)=>{n.d(t,{A:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"webspeech";this.recognition=null,this.isRecognizing=!1,this.isManuallyStopped=!1,this.initRecognition(e)}initRecognition(e){"webspeech"===e?(this.recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition),this.recognition.interimResults=!1,this.recognition.continuous=!0,this.recognition.lang="en-US"):console.error("Unsupported recognition type")}startContinuousRecognition(e){this.isRecognizing?(this.recognition.onend=()=>{this.isRecognizing=!1,this.startRecognitionProcess(e)},this.stopRecognition()):(this.isManuallyStopped=!1,this.startRecognitionProcess(e))}startRecognitionProcess(e){if(this.isRecognizing)return void console.warn("Recognition is already running, skipping start.");this.isRecognizing=!0;const t=[];this.recognition.onresult=n=>{const i=n.results;for(let e=n.resultIndex;e<i.length;e++)i[e].isFinal&&t.push(i[e][0].transcript.trim());e(t.join(" "))},this.recognition.onerror=t=>{"not-allowed"===t.error?(console.error("Recognition error: Microphone access was not allowed."),alert("Please allow microphone access to use the speech recognition feature."),this.stopRecognition()):"no-speech"===t.error?(console.warn("Recognition error: No speech detected."),this.isManuallyStopped||setTimeout((()=>{console.log("Restarting speech recognition after no-speech error..."),this.startRecognitionProcess(e)}),1e3)):(console.error("Recognition error:",t.error),this.stopRecognition())},this.recognition.onend=()=>{console.log("Speech recognition ended."),this.isRecognizing=!1,this.isManuallyStopped||(console.log("Restarting speech recognition..."),this.startRecognitionProcess(e))},this.recognition.start(),console.log("Speech recognition started.")}stopRecognition(){this.isRecognizing&&(this.isManuallyStopped=!0,this.recognition.stop(),console.log("Speech recognition stopped manually."),this.isRecognizing=!1)}}},34003:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(85522),s=n(53768),o=n(10157),r=n(13204),c=n(70579);const l=e=>{let{status:t}=e;return(0,c.jsx)(i.az,{position:"fixed",zIndex:"1000",bottom:"20px",left:"20px",bg:"gray.700",borderRadius:"md",p:4,boxShadow:"xl",userSelect:"none",children:(0,c.jsxs)(i.az,{display:"flex",flexDirection:"column",alignItems:"center",children:[(0,c.jsx)(s.I,{as:r.Qp1,color:{talking:"red.500",listening:"green.500",idle:"yellow.500"}[t],boxSize:6,mb:2}),(0,c.jsxs)(o.E,{color:"white",fontWeight:"bold",children:["talking"===t&&"Talking","listening"===t&&"Listening","idle"===t&&"Idle"]})]})})}},53409:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(65043);const s=(e,t,n,s,o)=>{const[r,c]=(0,i.useState)({status:"idle",transcribedText:null,speakingText:null}),l=(0,i.useRef)(o()).current,a=(0,i.useRef)(s()).current,g=(0,i.useCallback)((async e=>{e&&""!==e.trim()?(c((t=>({...t,status:"talking",speakingText:e}))),await t.enqueueText(e),c((e=>({...e,status:"listening",speakingText:null}))),h()):c((e=>({...e,status:"listening",speakingText:null})))}),[t]),u=(0,i.useCallback)((e=>{c((t=>({...t,status:"thinking",transcribedText:e})));const{value:t}=l.next(e);t&&g(t).then((()=>{const{value:e}=a.next();e?g(e):c((e=>({...e,status:"idle",speakingText:null})))}))}),[g,l,a]),h=(0,i.useCallback)((()=>{c((e=>({...e,status:"listening"}))),e.startContinuousRecognition((e=>{u(e)}))}),[e,u]);return{conversationState:r,startConversation:(0,i.useCallback)((async()=>{const{value:e}=a.next();c((t=>({...t,status:"talking",speakingText:e}))),await t.enqueueText(e),c((e=>({...e,status:"listening",speakingText:null}))),h()}),[t,h,a]),stopConversation:(0,i.useCallback)((()=>{e.stopRecognition(),t.stopSpeech(),c({status:"idle",transcribedText:null,speakingText:null})}),[e,t])}}},69814:(e,t,n)=>{n.r(t),n.d(t,{start:()=>p,stop:()=>f});var i=n(65043),s=n(93748),o=n(84391),r=n(53409),c=n(42026),l=n(96308),a=n(38462),g=n(34003),u=n(70579);let h=null;const d=e=>{let{animationManager:t}=e;const[n,o]=(0,i.useState)(0),h=(0,i.useRef)(n),d=(0,s.d)(),p=(0,i.useMemo)((()=>[{french:"Bonjour",english:"Hello"},{french:"Merci",english:"Thank you"},{french:"Chat",english:"Cat"},{french:"Tet",english:"Head"},{french:"Maison",english:"House"}]),[]);(0,i.useEffect)((()=>{h.current=n}),[n]);const f=(0,i.useMemo)((()=>function*(){for(let e of p)yield"Que veut dire ".concat(e.french," en anglais ?");yield"Vous avez termin\xe9 le quiz! Vous avez obtenu ".concat(h.current," bonnes r\xe9ponses sur ").concat(p.length,". Merci d'avoir particip\xe9!")}),[p]),x=(0,i.useMemo)((()=>function*(){for(let e of p){(yield).toLowerCase().includes(e.english.toLowerCase())?(o((e=>e+1)),yield"Correct!"):yield"Incorrect. La r\xe9ponse correcte est: ".concat(e.english)}}),[p]),[R,T]=(0,i.useState)({status:"idle",transcribedText:null,speakingText:null}),k=(0,i.useRef)(new c.A("webspeech")).current,m=(0,i.useRef)(l.A.getInstance(t)).current,w=(0,i.useRef)(new a.A(1e3,k,m)).current,{startConversation:b,stopConversation:v}=(0,r.A)(k,m,w,f,x);return(0,i.useEffect)((()=>(m.findAndSetVoice("Google fran\xe7ais").then((()=>{b()})),()=>{v()})),[b,v,m]),(0,i.useEffect)((()=>{"thinking"===R.status?d({title:"Processing...",description:"Processing your response...",status:"info",duration:2e3}):"talking"===R.status&&d({title:"Response",description:R.speakingText,status:"success",duration:4e3})}),[R.status,d]),(0,u.jsxs)("div",{children:[(0,u.jsx)(g.A,{status:R.status}),(0,u.jsx)("div",{children:(0,u.jsxs)("h2",{children:["Correct Answers: ",n]})})]})},p=(e,t,n)=>{n&&n.current?(h||(h=(0,o.createRoot)(n.current)),h.render((0,u.jsx)(d,{animationManager:e}))):console.error("Invalid container reference")},f=()=>{console.log("Stopping French Vocabulary Quiz..."),h&&(h.unmount(),h=null)}}}]);
//# sourceMappingURL=814.691ca8a1.chunk.js.map