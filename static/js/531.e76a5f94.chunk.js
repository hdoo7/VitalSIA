(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[531],{69108:(e,t,o)=>{"use strict";o.d(t,{A:()=>E});var s=o(65043),i=o(79336);class n{constructor(){this.videoElement=null,this.isProcessing=!1,this.intervalId=null}initVideo(e){this.videoElement=e}async loadModels(){const e="/EVA-libre/models";try{await i.B0.tinyFaceDetector.loadFromUri(e),await i.B0.faceLandmark68Net.loadFromUri(e),await i.B0.faceExpressionNet.loadFromUri(e),await i.B0.faceRecognitionNet.loadFromUri(e),console.log("Models loaded successfully")}catch(t){throw console.error("Error loading models:",t),new Error("Failed to load face-api models")}}async startVideoStream(){try{if(!this.videoElement)throw new Error("Video element not initialized.");await this.loadModels();const e=await navigator.mediaDevices.getUserMedia({video:!0});this.videoElement.srcObject=e}catch(e){console.error("Error accessing webcam:",e)}}startContinuousDetection(e){if(this.isProcessing)return void console.warn("Emotion detection is already running.");this.isProcessing=!0;this.intervalId=setInterval((async()=>{if(!this.videoElement)return;const t=await i.R(this.videoElement,new i.ex).withFaceLandmarks().withFaceExpressions();if(t.length>0){const o=t[0].expressions;e(o)}}),100)}stopDetection(){this.isProcessing&&(clearInterval(this.intervalId),this.isProcessing=!1)}stopVideoStream(){if(this.videoElement&&this.videoElement.srcObject){this.videoElement.srcObject.getTracks().forEach((e=>e.stop())),this.videoElement.srcObject=null}}}const r=()=>{const[e,t]=(0,s.useState)({detectedEmotion:null,emotionIntensities:{joy:0,anger:0,disgust:0,fear:0,sadness:0,surprise:0},status:"idle"}),o=(0,s.useRef)(new n).current,i=(0,s.useRef)(null);return{emotionState:e,startEmoDetection:(0,s.useCallback)((async()=>{if(i.current)try{o.initVideo(i.current),await o.startVideoStream(),t((e=>({...e,status:"detecting"}))),o.startContinuousDetection((e=>{const o={joy:e.happy||0,anger:e.angry||0,disgust:e.disgusted||0,fear:e.fearful||0,sadness:e.sad||0,surprise:e.surprised||0},s=Object.keys(o).reduce(((e,t)=>o[e]>o[t]?e:t));t({detectedEmotion:s,emotionIntensities:o,status:"detecting"})}))}catch(e){console.error("Error starting emotion detection:",e)}else console.error("Video element not provided.")}),[o]),stopEmoDetection:(0,s.useCallback)((()=>{o.stopDetection(),o.stopVideoStream(),t({detectedEmotion:null,status:"stopped",emotionIntensities:{}})}),[o]),videoElementRef:i}};var a=o(85522),d=o(39627),l=o(34693),c=o(4758),u=o(70579);const m=e=>{let{videoElementRef:t,emotionState:o}=e;const[i,n]=(0,s.useState)({x:0,y:0}),[r,m]=(0,s.useState)(!1),[h,g]=(0,s.useState)(!1);return(0,u.jsxs)(a.az,{position:"fixed",width:h?"100px":"300px",height:h?"50px":"200px",cursor:h?"default":"move",onMouseDown:h?null:e=>{m(!0)},onMouseMove:h?null:e=>{if(r){const t=e.clientX-e.target.offsetWidth/2,o=e.clientY-e.target.offsetHeight/2;n({x:t,y:o})}},onMouseUp:h?null:()=>{m(!1);const e=window.innerWidth,t=i.x<e/2?10:e-event.target.offsetWidth-10,o=window.innerHeight-event.target.offsetHeight-10;n({x:t,y:o})},style:{left:"".concat(i.x,"px"),top:"".concat(i.y,"px"),zIndex:1e3},border:"2px solid gray",borderRadius:"10px",overflow:"hidden",boxShadow:"lg",bg:"gray.900",children:[(0,u.jsx)(a.az,{position:"absolute",top:"0",right:"0",children:(0,u.jsx)(d.K,{icon:h?(0,u.jsx)(l.M,{}):(0,u.jsx)(c.D,{}),size:"sm",onClick:()=>{g(!h)},"aria-label":"Toggle collapse"})}),!h&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("video",{ref:t,autoPlay:!0,muted:!0,style:{width:"100%",height:"100%"}}),(0,u.jsx)(a.az,{position:"absolute",bottom:"0",left:"0",p:"2",color:"white",bg:"rgba(0, 0, 0, 0.5)",children:o.detectedEmotion&&(0,u.jsxs)("div",{children:["Detected Emotion: ",o.detectedEmotion]})})]})]})};var h=o(6058),g=o(461);g.t1.register(g.pr,g.FN,g.No,g.dN,g.m_,g.s$);const p=e=>{let{emotionIntensities:t}=e;const o={labels:["Joy","Anger","Disgust","Fear","Sadness","Surprise"],datasets:[{label:"Emotion Intensities",data:[t.joy,t.anger,t.disgust,t.fear,t.sadness,t.surprise],backgroundColor:"rgba(34, 202, 236, 0.2)",borderColor:"rgba(34, 202, 236, 1)",borderWidth:2}]};return(0,u.jsx)(a.az,{width:"400px",height:"400px",p:4,children:(0,u.jsx)(h.Vd,{data:o,options:{scale:{ticks:{beginAtZero:!0,max:1},angleLines:{display:!0}}}})})};var f=o(11806);const E=e=>{let{onEmotionStateChange:t}=e;const{emotionState:o,startEmoDetection:i,stopEmoDetection:n,videoElementRef:a}=r();return(0,s.useEffect)((()=>(i(),()=>{n()})),[i,n]),(0,s.useEffect)((()=>{t&&t(o)}),[o,t]),(0,u.jsxs)("div",{children:[(0,u.jsx)(m,{videoElementRef:a,emotionState:o}),(0,u.jsx)(p,{emotionIntensities:o.emotionIntensities}),(0,u.jsx)(f.A,{text:o.detectedEmotion||""})]})}},77419:(e,t,o)=>{"use strict";o.r(t),o.d(t,{start:()=>a,stop:()=>d});var s=o(84391),i=(o(65043),o(69108)),n=o(70579);let r=null;const a=(e,t,o)=>{o&&o.current?(r||(r=s.createRoot(o.current)),r.render((0,n.jsx)(i.A,{animationManager:e,settings:t}))):console.error("Container reference not provided or invalid. Unable to start FaceDetectionApp.")},d=()=>{r&&(r.unmount(),r=null)}},18082:()=>{},97318:()=>{},40745:()=>{},41591:()=>{}}]);
//# sourceMappingURL=531.e76a5f94.chunk.js.map