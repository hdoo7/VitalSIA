"use strict";(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[312],{42026:(e,t,n)=>{n.d(t,{A:()=>s});class s{constructor(){this.recognition=null,this.isListening=!1}initializeRecognizer(){return"webkitSpeechRecognition"in window?(this.recognition=new window.webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!1,this.recognition.lang="en-US",Promise.resolve()):(console.error("Web Speech API not supported in this browser."),Promise.reject("Web Speech API not supported"))}startContinuousRecognition(e){if(!this.isListening)return new Promise(((t,n)=>{this.initializeRecognizer().then((()=>{this.recognition.onresult=t=>{const n=Array.from(t.results).map((e=>e[0].transcript)).join("");console.log("RECOGNIZED: ".concat(n.trim())),e(n.trim())},this.recognition.onerror=e=>{console.error("Speech recognition error:",e.error),"no-speech"===e.error?(console.warn("No speech detected, resuming listening..."),setTimeout((()=>{this.recognition.start()}),1e3)):n(e.error)},this.recognition.onend=()=>{console.log("Speech recognition ended, restarting..."),this.isListening&&this.recognition.start()},this.isListening=!0,this.recognition.start(),t()})).catch((e=>{console.error("Error initializing speech recognition:",e),n(e)}))}));console.warn("Recognition is already running.")}stopRecognition(){this.recognition&&(this.isListening=!1,this.recognition.stop(),console.log("Recognition stopped."))}}},49312:(e,t,n)=>{n.r(t),n.d(t,{start:()=>j,stop:()=>z});var s=n(84391),o=n(65043),i=n(93748),r=n(42026);class c{constructor(e){if(Array.isArray(e))this.phrases=e.join(" ");else{if("string"!==typeof e)throw new Error("Phrases must be either a string or an array of strings");this.phrases=e}this.lastDetectedPhrase=null}listen(e){return new Promise((t=>{const n=this.detectTriggerPhrase(e);n?(this.lastDetectedPhrase=n,t(n)):t(null)}))}detectTriggerPhrase(e){return this.phrases.includes(e.toLowerCase())?e:null}}class l extends c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2?arguments[2]:void 0;super(e),this.awaitingFollowUp=!1,this.lastDetectedPhrase=null,this.audioToText=n,this.debounceTimer=null,this.bufferTime=t}startListening(e){this.audioToText.startContinuousRecognition(e)}stopListening(){this.audioToText.stopRecognition()}listenForStream(e){return new Promise((t=>{this.awaitingFollowUp?(this.awaitingFollowUp=!1,t({phrase:this.lastDetectedPhrase,followUp:e}),this.lastDetectedPhrase=null):super.listen(e).then((e=>{e?(this.awaitingFollowUp=!0,this.lastDetectedPhrase=e,t({phrase:e,followUp:null})):t(null)}))}))}resumeListeningAfterResponse(e,t){setTimeout((()=>{e("listening"),this.startListening(t)}),this.bufferTime)}processUtterance(e){const t=[];let n="";return e.split(" ").forEach((e=>{n.length+e.length+1>120?(t.push(n),n=e):n+=(0===n.length?"":" ")+e})),n.length>0&&t.push(n),t}}const a=class{constructor(e){if(!e||"string"!==typeof e)throw new Error("A valid OpenAI API key must be provided.");this.apiKey=e,this.apiUrl="https://api.openai.com/v1/chat/completions"}async processText(e){const t={model:"gpt-3.5-turbo",messages:[{role:"system",content:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Answer in a professional manner:"},{role:"user",content:e}],max_tokens:150,temperature:.7};try{var n,s,o,i;const e=await fetch(this.apiUrl,{method:"POST",headers:{Authorization:"Bearer ".concat(this.apiKey),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("API request failed with status: ".concat(e.status));const r=null===(n=(await e.json()).choices)||void 0===n||null===(s=n[0])||void 0===s||null===(o=s.message)||void 0===o||null===(i=o.content)||void 0===i?void 0:i.trim();if(!r)throw new Error("Failed to get a valid response from the API");return r}catch(r){throw console.error("Error processing text with GPT:",r),r}}};var h=n(96308),g=n(85522),u=n(53768),p=n(10157),d=n(13204),m=n(70579);const w=e=>{let{status:t}=e;return(0,m.jsx)(g.az,{position:"fixed",zIndex:"1000",bottom:"20px",left:"20px",bg:"gray.700",borderRadius:"md",p:4,boxShadow:"xl",userSelect:"none",children:(0,m.jsxs)(g.az,{display:"flex",flexDirection:"column",alignItems:"center",children:[(0,m.jsx)(u.I,{as:d.Qp1,color:{talking:"red.500",listening:"green.500",idle:"yellow.500"}[t],boxSize:6,mb:2}),(0,m.jsxs)(p.E,{color:"white",fontWeight:"bold",children:["talking"===t&&"Talking","listening"===t&&"Listening","idle"===t&&"Idle"]})]})})};let f,x,T,b,A=!1,y=!1,P="",R=null;const v=2e3,L=(e,t)=>{const n=t.triggerPhrases||[],s=t.apiKey;return f=new r.A("webspeech"),x=new l(n,v,f),T=new a(s),b=h.A.getInstance(e),o="Samantha",new Promise((e=>{console.log("Attempting to set the voice to ".concat(o,"..."));const t=()=>{const n=b.getVoices().find((e=>e.name.includes(o)));n?(b.setVoice(n.name),console.log("Voice set: ".concat(n.name)),e()):(console.log("".concat(o," voice not found, retrying...")),setTimeout(t,500))};t()}));var o},E=e=>{const t=[];let n="";return e.split(" ").forEach((e=>{n.length+e.length+1>120?(t.push(n),n=e):n+=(0===n.length?"":" ")+e})),n.length>0&&t.push(n),t},S=(e,t,n)=>{(e=>P&&e.includes(P))(e)?console.log("Ignoring agent\u2019s own speech."):(console.log("Transcribed text: ".concat(e)),n({title:"Transcribed text",description:e,status:"info",duration:2e3}),A?I(e,t,n):k(e,t,n))},k=(e,t,n)=>{A=!0,P="Let me check that for you...",y=!0,x.stopListening(),b.enqueueText(P),t("talking"),n({title:"Trigger Detected",description:'You said: "'.concat(e,'". Processing...'),status:"success",duration:3e3}),T.processText(e,"Answer seriously:").then((e=>{if(e){E(e).forEach((e=>{b.enqueueText(e)})),P=e}t("idle"),y=!1,setTimeout((()=>{console.log("Resuming listening after trigger response..."),x.resumeListeningAfterResponse(t,(e=>S(e,t,n)))}),v)})).catch((e=>{console.error("Error processing trigger phrase:",e),x.resumeListeningAfterResponse(t,(e=>S(e,t,n)))}))},I=(e,t,n)=>{y=!0,x.stopListening(),T.processText(e,"Answer seriously:").then((e=>{if(e){E(e).forEach((e=>{b.enqueueText(e)})),P=e}t("idle"),y=!1,setTimeout((()=>{console.log("Resuming listening after follow-up..."),x.resumeListeningAfterResponse(t,(e=>S(e,t,n)))}),v)})).catch((e=>{console.error("Error processing follow-up:",e),x.resumeListeningAfterResponse(t,(e=>S(e,t,n)))}))},j=(e,t,n)=>{n&&n.current?L(e,t).then((()=>{const e=()=>{const[e,t]=(0,o.useState)("idle"),n=(0,i.d)();return(0,o.useEffect)((()=>(x.startListening((e=>S(e,t,n))),()=>{f.stopRecognition()})),[t,n]),(0,m.jsx)(w,{status:e})};R||(R=s.createRoot(n.current)),R.render((0,m.jsx)(e,{}))})):console.error("Invalid container reference")},z=()=>{f&&f.stopRecognition(),b&&b.stopSpeech(),R&&(R.unmount(),R=null)}}}]);
//# sourceMappingURL=312.3f467a3c.chunk.js.map