"use strict";(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[529],{42026:(e,t,n)=>{n.d(t,{A:()=>o});class o{constructor(){this.recognition=null,this.isListening=!1}initializeRecognizer(){return"webkitSpeechRecognition"in window?(this.recognition=new window.webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!1,this.recognition.lang="en-US",Promise.resolve()):(console.error("Web Speech API not supported in this browser."),Promise.reject("Web Speech API not supported"))}startContinuousRecognition(e){if(!this.isListening)return new Promise(((t,n)=>{this.initializeRecognizer().then((()=>{this.recognition.onresult=t=>{const n=Array.from(t.results).map((e=>e[0].transcript)).join("");console.log("RECOGNIZED: ".concat(n.trim())),e(n.trim())},this.recognition.onerror=e=>{console.error("Speech recognition error:",e.error),n(e.error)},this.recognition.onend=()=>{this.isListening&&this.recognition.start()},this.isListening=!0,this.recognition.start(),t()})).catch((e=>{console.error("Error initializing speech recognition:",e),n(e)}))}));console.warn("Recognition is already running.")}stopRecognition(){this.recognition&&(this.isListening=!1,this.recognition.stop(),console.log("Recognition stopped."))}}},44529:(e,t,n)=>{n.r(t),n.d(t,{start:()=>P,stop:()=>E});var o=n(84391),i=n(65043),s=n(93748),r=n(42026);class c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.triggerPhrases=Array.isArray(e)?e.map((e=>e.toLowerCase().trim())):[],this.bufferTime=t,this.debounceTimer=null,this.utterances=[]}detectKeyPhrase(e){const t=e.toLowerCase().trim();return this.triggerPhrases.find((e=>t.includes(e)))}processUtterance(e,t){this.debounceTimer&&clearTimeout(this.debounceTimer),this.utterances.push(e),this.debounceTimer=setTimeout((()=>{const e=this.utterances.join(" ");this.utterances=[];const n=this.detectKeyPhrase(e);t&&t(n||e)}),this.bufferTime)}startListening(e){if(!window.SpeechRecognition&&!window.webkitSpeechRecognition)return void console.error("SpeechRecognition API is not supported.");const t=new(window.SpeechRecognition||window.webkitSpeechRecognition);t.continuous=!0,t.interimResults=!1,t.lang="en-US",t.onresult=t=>{const n=t.results[t.results.length-1][0].transcript;console.log("Transcribed utterance:",n),this.processUtterance(n,e)},t.start(),console.log("TextToListenerWithFollowUp started listening...")}stopListening(){this.speechRecognition&&(this.speechRecognition.stop(),console.log("TextToListenerWithFollowUp stopped listening."))}}const l=class{constructor(e){if(!e||"string"!==typeof e)throw new Error("A valid OpenAI API key must be provided.");this.apiKey=e,this.apiUrl="https://api.openai.com/v1/chat/completions"}async processText(e){const t={model:"gpt-3.5-turbo",messages:[{role:"system",content:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Answer in a professional manner:"},{role:"user",content:e}],max_tokens:150,temperature:.7};try{var n,o,i,s;const e=await fetch(this.apiUrl,{method:"POST",headers:{Authorization:"Bearer ".concat(this.apiKey),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("API request failed with status: ".concat(e.status));const r=null===(n=(await e.json()).choices)||void 0===n||null===(o=n[0])||void 0===o||null===(i=o.message)||void 0===i||null===(s=i.content)||void 0===s?void 0:s.trim();if(!r)throw new Error("Failed to get a valid response from the API");return r}catch(r){throw console.error("Error processing text with GPT:",r),r}}};var a=n(96308),h=n(85522),g=n(53768),u=n(10157),p=n(13204),d=n(70579);const w=e=>{let{status:t}=e;return(0,d.jsx)(h.az,{position:"fixed",zIndex:"1000",bottom:"20px",left:"20px",bg:"gray.700",borderRadius:"md",p:4,boxShadow:"xl",userSelect:"none",children:(0,d.jsxs)(h.az,{display:"flex",flexDirection:"column",alignItems:"center",children:[(0,d.jsx)(g.I,{as:p.Qp1,color:{talking:"red.500",listening:"green.500",idle:"yellow.500"}[t],boxSize:6,mb:2}),(0,d.jsxs)(u.E,{color:"white",fontWeight:"bold",children:["talking"===t&&"Talking","listening"===t&&"Listening","idle"===t&&"Idle"]})]})})};let m,f,b,x,T=!1,R=!1,y="",A=null;const S=e=>{const t=[];let n="";return e.split(" ").forEach((e=>{n.length+e.length+1>120?(t.push(n),n=e):n+=(0===n.length?"":" ")+e})),n.length>0&&t.push(n),t},v=(e,t,n)=>{(e=>y&&e.includes(y))(e)?console.log("Ignoring agent\u2019s own speech."):(console.log("Transcribed text: ".concat(e)),n({title:"Transcribed text",description:e,status:"info",duration:2e3}),R&&(x.stopSpeech(),t("idle")),f.listenForStream(e).then((e=>{e?e.phrase&&!T?L(e.phrase,t,n):e.followUp&&T?k(e.followUp,t,n):console.error("Unexpected result format:",e):console.error("No result returned from listening.")})).catch((e=>{console.error("Error processing text:",e)})))},L=(e,t,n)=>{T=!0,y="Let me check that for you...",R=!0,f.stopListening(),x.enqueueText(y),t("talking"),n({title:"Trigger Detected",description:'You said: "'.concat(e,'". Processing...'),status:"success",duration:3e3}),b.processText(e,"Answer seriously:").then((e=>{if(e){S(e).forEach((e=>{x.enqueueText(e)})),y=e}t("idle"),R=!1,f.resumeListeningAfterResponse(t,(e=>v(e,t,n)))}))},k=(e,t,n)=>{R=!0,f.stopListening(),t("talking"),b.processText(e,"Answer seriously:").then((e=>{if(e){S(e).forEach((e=>{x.enqueueText(e)})),y=e}t("idle"),R=!1,f.resumeListeningAfterResponse(t,(e=>v(e,t,n)))}))},P=(e,t,n)=>{if(!n||!n.current)return void console.error("Invalid container reference");((e,t)=>{const n=t.triggerPhrases||[],o=t.apiKey;m=new r.A("webspeech"),f=new c(n,2e3,m),b=new l(o),x=a.A.getInstance(e)})(e,t);const h=()=>{const[e,t]=(0,i.useState)("idle"),n=(0,s.d)();return(0,i.useEffect)((()=>(f.startListening((e=>v(e,t,n))),()=>{m.stopRecognition()})),[t,n]),(0,d.jsx)(w,{status:e})};A||(A=o.createRoot(n.current)),A.render((0,d.jsx)(h,{}))},E=()=>{m&&m.stopRecognition(),x&&x.stopSpeech(),A&&(A.unmount(),A=null)}}}]);
//# sourceMappingURL=529.f1c1e7a3.chunk.js.map