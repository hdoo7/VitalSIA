"use strict";(self.webpackChunkEVA_libre=self.webpackChunkEVA_libre||[]).push([[312],{42026:(e,t,i)=>{i.d(t,{A:()=>n});class n{constructor(){this.recognition=null,this.isListening=!1}initializeRecognizer(){return"webkitSpeechRecognition"in window?(this.recognition=new window.webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!1,this.recognition.lang="en-US",Promise.resolve()):(console.error("Web Speech API not supported in this browser."),Promise.reject("Web Speech API not supported"))}startContinuousRecognition(e){if(!this.isListening)return new Promise(((t,i)=>{this.initializeRecognizer().then((()=>{this.recognition.onresult=t=>{const i=Array.from(t.results).map((e=>e[0].transcript)).join("");console.log("RECOGNIZED: ".concat(i.trim())),e(i.trim())},this.recognition.onerror=e=>{console.error("Speech recognition error:",e.error),i(e.error)},this.recognition.onend=()=>{this.isListening&&this.recognition.start()},this.isListening=!0,this.recognition.start(),t()})).catch((e=>{console.error("Error initializing speech recognition:",e),i(e)}))}));console.warn("Recognition is already running.")}stopRecognition(){this.recognition&&(this.isListening=!1,this.recognition.stop(),console.log("Recognition stopped."))}}},49312:(e,t,i)=>{i.r(t),i.d(t,{start:()=>k,stop:()=>I});var n=i(84391),s=i(65043),o=i(93748),r=i(42026);class l{constructor(e){if(Array.isArray(e))this.phrases=e.join(" ");else{if("string"!==typeof e)throw new Error("Phrases must be either a string or an array of strings");this.phrases=e}this.lastDetectedPhrase=null}listen(e){return new Promise((t=>{const i=this.detectTriggerPhrase(e);i?(this.lastDetectedPhrase=i,t(i)):t(null)}))}detectTriggerPhrase(e){return this.phrases.includes(e.toLowerCase())?e:null}}class c extends l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2?arguments[2]:void 0;super(e),this.awaitingFollowUp=!1,this.lastDetectedPhrase=null,this.audioToText=i,this.debounceTimer=null,this.bufferTime=t}startListening(e){this.audioToText.startContinuousRecognition(e)}stopListening(){this.audioToText.stopRecognition()}listenForStream(e){return new Promise((t=>{this.awaitingFollowUp?(this.awaitingFollowUp=!1,t({phrase:this.lastDetectedPhrase,followUp:e}),this.lastDetectedPhrase=null):super.listen(e).then((e=>{e?(this.awaitingFollowUp=!0,this.lastDetectedPhrase=e,t({phrase:e,followUp:null})):t(null)}))}))}resumeListeningAfterResponse(e,t){setTimeout((()=>{e("listening"),this.startListening(t)}),this.bufferTime)}}const a=class{constructor(e){if(!e||"string"!==typeof e)throw new Error("A valid OpenAI API key must be provided.");this.apiKey=e,this.apiUrl="https://api.openai.com/v1/chat/completions"}async processText(e){const t={model:"gpt-3.5-turbo",messages:[{role:"system",content:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Answer in a professional manner:"},{role:"user",content:e}],max_tokens:150,temperature:.7};try{var i,n,s,o;const e=await fetch(this.apiUrl,{method:"POST",headers:{Authorization:"Bearer ".concat(this.apiKey),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("API request failed with status: ".concat(e.status));const r=null===(i=(await e.json()).choices)||void 0===i||null===(n=i[0])||void 0===n||null===(s=n.message)||void 0===s||null===(o=s.content)||void 0===o?void 0:o.trim();if(!r)throw new Error("Failed to get a valid response from the API");return r}catch(r){throw console.error("Error processing text with GPT:",r),r}}};var h=i(96308),g=i(85522),u=i(53768),p=i(10157),d=i(13204),w=i(70579);const f=e=>{let{status:t}=e;return(0,w.jsx)(g.az,{position:"fixed",zIndex:"1000",bottom:"20px",left:"20px",bg:"gray.700",borderRadius:"md",p:4,boxShadow:"xl",userSelect:"none",children:(0,w.jsxs)(g.az,{display:"flex",flexDirection:"column",alignItems:"center",children:[(0,w.jsx)(u.I,{as:d.Qp1,color:{talking:"red.500",listening:"green.500",idle:"yellow.500"}[t],boxSize:6,mb:2}),(0,w.jsxs)(p.E,{color:"white",fontWeight:"bold",children:["talking"===t&&"Talking","listening"===t&&"Listening","idle"===t&&"Idle"]})]})})};let m,x,b,T,y=!1,P=!1,A="",R=null;const v=e=>{const t=[];let i="";return e.split(" ").forEach((e=>{i.length+e.length+1>120?(t.push(i),i=e):i+=(0===i.length?"":" ")+e})),i.length>0&&t.push(i),t},L=(e,t,i)=>{(e=>A&&e.includes(A))(e)?console.log("Ignoring agent\u2019s own speech."):(console.log("Transcribed text: ".concat(e)),i({title:"Transcribed text",description:e,status:"info",duration:2e3}),P&&(T.stopSpeech(),t("idle")),x.listenForStream(e).then((e=>{e.phrase&&!y?E(e.phrase,t,i):e.followUp&&y&&S(e.followUp,t,i)})).catch((e=>{console.error("Error processing text:",e)})))},E=(e,t,i)=>{y=!0,A="Let me check that for you...",P=!0,x.stopListening(),T.enqueueText(A),t("talking"),i({title:"Trigger Detected",description:'You said: "'.concat(e,'". Processing...'),status:"success",duration:3e3}),b.processText(e,"Answer seriously:").then((e=>{if(e){v(e).forEach((e=>{T.enqueueText(e)})),A=e}t("idle"),P=!1,x.resumeListeningAfterResponse(t,(e=>L(e,t,i)))}))},S=(e,t,i)=>{P=!0,x.stopListening(),t("talking"),b.processText(e,"Answer seriously:").then((e=>{if(e){v(e).forEach((e=>{T.enqueueText(e)})),A=e}t("idle"),P=!1,x.resumeListeningAfterResponse(t,(e=>L(e,t,i)))}))},k=(e,t,i)=>{if(!i||!i.current)return void console.error("Invalid container reference");((e,t)=>{const i=t.triggerPhrases||[],n=t.apiKey;m=new r.A("webspeech"),x=new c(i,2e3,m),b=new a(n),T=h.A.getInstance(e)})(e,t);const l=()=>{const[e,t]=(0,s.useState)("idle"),i=(0,o.d)();return(0,s.useEffect)((()=>(x.startListening((e=>L(e,t,i))),()=>{m.stopRecognition()})),[t,i]),(0,w.jsx)(f,{status:e})};R||(R=n.createRoot(i.current)),R.render((0,w.jsx)(l,{}))},I=()=>{m&&m.stopRecognition(),T&&T.stopSpeech(),R&&(R.unmount(),R=null)}}}]);
//# sourceMappingURL=312.e13a9a22.chunk.js.map